{% load static %}
<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}ATELIER{% endblock %}</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;500;600&family=Inter:wght@300;400;500&display=swap" rel="stylesheet">
    
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                        serif: ['Playfair Display', 'serif'],
                    },
                    colors: {
                        background: '#ffffff',
                        foreground: '#09090b',
                        muted: '#f4f4f5',
                        primary: '#18181b', 
                    }
                }
            }
        }
    </script>
    <style>
        .hide-scrollbar::-webkit-scrollbar { display: none; }
        .hide-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        
        /* Animações Globais */
        @keyframes scaleIn { from { transform: scale(1.1); opacity: 0; } to { transform: scale(1); opacity: 1; } }
        .animate-hero-image { animation: scaleIn 1.5s ease-out forwards; }

        @keyframes slideUpFade { from { transform: translateY(30px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
        .animate-slide-up { opacity: 0; animation: slideUpFade 0.8s ease-out forwards; }
    </style>
</head>
<body class="bg-background text-foreground antialiased selection:bg-gray-200 flex flex-col min-h-screen">

    <nav class="fixed top-0 left-0 right-0 z-50 bg-white/10 backdrop-blur-md border-b border-white/10 transition-all duration-300 hover:bg-white/95 hover:border-gray-200 hover:shadow-sm group">
        <div class="container mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex items-center justify-between h-16">
                <a href="{% url 'home' %}" class="font-serif text-2xl font-semibold tracking-tight text-white group-hover:text-black transition-colors">
                    ATELIER
                </a>

                <div class="hidden md:flex items-center gap-8">
                    <a href="{% url 'home' %}" class="text-sm font-medium text-white/90 hover:text-white group-hover:text-gray-800 transition-colors">Coleções</a>
                    <a class="nav-link" href="{% url 'sobre' %}">Sobre</a>
                </div>

                <button onclick="toggleCart()" class="relative p-2 rounded-full transition-colors hover:bg-white/20 group-hover:hover:bg-gray-100">
                    <i data-lucide="shopping-bag" class="w-6 h-6 text-white group-hover:text-gray-700"></i>
                    <span id="cart-badge" class="absolute -top-1 -right-1 w-5 h-5 bg-white text-black group-hover:bg-black group-hover:text-white text-[10px] font-medium rounded-full flex items-center justify-center transform scale-0 transition-transform duration-200">
                        0
                    </span>
                </button>
            </div>
        </div>
    </nav>

    {% block content %}
    {% endblock %}

    <footer class="border-t border-muted py-12 bg-white mt-auto">
        <div class="container mx-auto px-4 text-center">
            <p class="text-sm text-muted-foreground">© 2025 ATELIER. Todos os direitos reservados.</p>
        </div>
    </footer>

    <div id="cart-overlay" onclick="toggleCart()" class="fixed inset-0 bg-black/20 backdrop-blur-sm z-50 hidden opacity-0 transition-opacity duration-300"></div>

    <div id="cart-drawer" class="fixed right-0 top-0 h-full w-full sm:w-[400px] bg-background shadow-2xl z-[60] transform translate-x-full transition-transform duration-500 cubic-bezier(0.16, 1, 0.3, 1) flex flex-col">
        <div class="flex items-center justify-between p-6 border-b border-muted">
            <h2 class="text-xl font-serif font-medium">Seu Carrinho</h2>
            <button onclick="toggleCart()" class="p-2 hover:bg-muted rounded-full transition-colors">
                <i data-lucide="x" class="w-5 h-5 text-foreground"></i>
            </button>
        </div>

        <div id="cart-items-container" class="flex-1 overflow-y-auto p-6 space-y-6 hide-scrollbar">
            </div>

        <div id="cart-footer" class="border-t border-muted p-6 space-y-4 bg-muted/20 hidden">
            
            <div class="flex items-center justify-between text-lg font-medium">
                <span>Total</span>
                <span id="cart-total-price" class="font-serif">R$ 0,00</span>
            </div>
            
            <div>
                <label class="block text-xs font-medium text-gray-500 mb-1">MÉTODO DE PAGAMENTO</label>
                <select id="payment-method" class="w-full p-2 text-sm border border-gray-200 rounded bg-white focus:ring-1 focus:ring-black outline-none">
                    <option value="PIX">PIX</option>
                    <option value="Cartão de Crédito">Cartão de Crédito</option>
                    <option value="Dinheiro">Dinheiro</option>
                </select>
            </div>

            <button onclick="checkoutWhatsApp()" class="w-full bg-primary text-white py-4 text-sm font-medium tracking-wide hover:opacity-90 transition-all active:scale-[0.98]">
                FINALIZAR NO WHATSAPP
            </button>
        </div>
    </div>

    <div id="toast" class="fixed bottom-6 right-6 bg-primary text-white px-6 py-3 rounded shadow-lg transform translate-y-20 opacity-0 transition-all duration-300 z-[70]">
        <span id="toast-msg">Produto adicionado</span>
    </div>

    <script>
        const WHATSAPP_NUMBER = "5582993186971"; 
        let cart = JSON.parse(localStorage.getItem('loja_cart')) || [];

        // Inicialização
        document.addEventListener('DOMContentLoaded', () => {
            lucide.createIcons();
            updateCartUI();
        });


        window.addEventListener('scroll', () => {
            const nav = document.querySelector('nav');
            if (window.scrollY > 50) {
                nav.classList.add('bg-white/95', 'shadow-sm', 'text-black');
                nav.classList.remove('bg-white/10', 'border-white/10');
                nav.querySelectorAll('i').forEach(icon => icon.classList.replace('text-white', 'text-black'));
                nav.querySelectorAll('a').forEach(link => link.classList.remove('text-white', 'text-white/90'));
            } else {
                nav.classList.remove('bg-white/95', 'shadow-sm', 'text-black');
                nav.classList.add('bg-white/10', 'border-white/10');

                nav.querySelectorAll('i').forEach(icon => icon.classList.replace('text-black', 'text-white'));
                nav.querySelectorAll('a').forEach(link => link.classList.add('text-white'));
            }
        });

        function toggleCart() {
            const drawer = document.getElementById('cart-drawer');
            const overlay = document.getElementById('cart-overlay');
            const isClosed = drawer.classList.contains('translate-x-full');

            if (isClosed) {
                drawer.classList.remove('translate-x-full');
                overlay.classList.remove('hidden');
                setTimeout(() => overlay.classList.remove('opacity-0'), 10);
            } else {
                drawer.classList.add('translate-x-full');
                overlay.classList.add('opacity-0');
                setTimeout(() => overlay.classList.add('hidden'), 300);
            }
        }


        function addToCart(id, name, price, image, size = null) {
            const priceFloat = parseFloat(String(price).replace(',', '.'));
            
            const existingItem = cart.find(item => item.id === id);
            
            if (existingItem) { 
                existingItem.quantity += 1; 
            } else { 
                cart.push({ id, name, price: priceFloat, image, quantity: 1, size: size }); 
            }
            
            saveCart();
            updateCartUI();
            showToast(`${name} adicionado ao carrinho`);
            
            const drawer = document.getElementById('cart-drawer');
            if(drawer.classList.contains('translate-x-full')) toggleCart();
        }

        function removeFromCart(id) {
            cart = cart.filter(item => item.id !== id);
            saveCart();
            updateCartUI();
        }

        function updateQuantity(id, delta) {
            const item = cart.find(item => item.id === id);
            if (item) {
                item.quantity += delta;
                if (item.quantity <= 0) removeFromCart(id);
                else { saveCart(); updateCartUI(); }
            }
        }

        function saveCart() { localStorage.setItem('loja_cart', JSON.stringify(cart)); }

        function updateCartUI() {
            const container = document.getElementById('cart-items-container');
            const badge = document.getElementById('cart-badge');
            const footer = document.getElementById('cart-footer');
            const totalPriceEl = document.getElementById('cart-total-price');

            const totalQty = cart.reduce((acc, item) => acc + item.quantity, 0);
            badge.innerText = totalQty;
            badge.classList.toggle('scale-0', totalQty === 0);

            if (cart.length === 0) {
                footer.classList.add('hidden');
                container.innerHTML = `
                    <div class="h-full flex flex-col items-center justify-center text-center text-muted-foreground">
                        <i data-lucide="shopping-bag" class="w-12 h-12 opacity-20 mb-3"></i>
                        <p>Seu carrinho está vazio</p>
                    </div>`;
            } else {
                footer.classList.remove('hidden');
                container.innerHTML = cart.map(item => `
                    <div class="flex gap-4 animate-fade-in border-b border-gray-50 pb-4 last:border-0">
                        <div class="w-20 h-20 bg-muted rounded overflow-hidden flex-shrink-0">
                            ${item.image ? `<img src="${item.image}" class="w-full h-full object-cover">` : '<div class="flex items-center justify-center h-full text-xs">Sem foto</div>'}
                        </div>
                        <div class="flex-1 min-w-0 flex flex-col justify-between py-1">
                            <div>
                                <h3 class="font-medium text-sm text-foreground truncate">${item.name}</h3>
                                
                                ${item.size ? `<p class="text-xs text-gray-500 mt-0.5">Tam: ${item.size}</p>` : ''}
                                
                                <p class="text-xs text-muted-foreground mt-1">R$ ${item.price.toFixed(2)}</p>
                            </div>
                            <div class="flex items-center justify-between mt-2">
                                <div class="flex items-center gap-3 bg-muted rounded px-2 py-1">
                                    <button onclick="updateQuantity('${item.id}', -1)" class="hover:text-black text-gray-500"><i data-lucide="minus" class="w-3 h-3"></i></button>
                                    <span class="text-xs font-medium w-4 text-center">${item.quantity}</span>
                                    <button onclick="updateQuantity('${item.id}', 1)" class="hover:text-black text-gray-500"><i data-lucide="plus" class="w-3 h-3"></i></button>
                                </div>
                                <span class="font-medium text-sm">R$ ${(item.price * item.quantity).toFixed(2)}</span>
                            </div>
                        </div>
                    </div>`).join('');
            }
            const total = cart.reduce((acc, item) => acc + (item.price * item.quantity), 0);
            totalPriceEl.innerText = total.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' });
            lucide.createIcons();
        }

        function checkoutWhatsApp() {
            if (cart.length === 0) return;
            
            const total = cart.reduce((acc, item) => acc + (item.price * item.quantity), 0);
            const refId = Math.random().toString(36).substring(2, 8).toUpperCase();
            

            const payment = document.getElementById('payment-method').value;

            let msg = `Olá! Gostaria de finalizar o pedido no * *:\n\n`;
            
            cart.forEach(item => { 
                const sizeInfo = item.size ? ` (Tam: ${item.size})` : '';
                msg += `▪ ${item.quantity}x ${item.name}${sizeInfo} - R$ ${(item.price * item.quantity).toFixed(2)}\n`; 
            });

            msg += `\n*Subtotal:* R$ ${total.toFixed(2)}`;
            msg += `\n*Pagamento:* ${payment}`;

            window.open(`https://wa.me/${WHATSAPP_NUMBER}?text=${encodeURIComponent(msg)}`, '_blank');
        }

        function showToast(message) {
            const toast = document.getElementById('toast');
            document.getElementById('toast-msg').innerText = message;
            toast.classList.remove('translate-y-20', 'opacity-0');
            setTimeout(() => { toast.classList.add('translate-y-20', 'opacity-0'); }, 3000);
        }
    </script>
</body>
</html>